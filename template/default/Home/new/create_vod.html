<!DOCTYPE HTML>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>创建点播</title>
    <meta charset="utf-8">
    <meta http-equiv=“X-UA-Compatible” content=“IE=8″>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <link rel="stylesheet" href="{$webpath}views/css/newcss/sesizer.css">
    <link rel="stylesheet" href="{$webpath}views/css/newcss/personal.css">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
</head>
<body>
<div class="mask2"></div>
<!-- 视屏服务器端url地址 -->
<div class="box ma0">
    <include file="header"/>
    <div class="contents">
        <div class="center pdt20 clearfix w1180">
            <include file="personal_center_left" />
                <div class="col_right zb fr">
                    <div class="right_top pd30">
                        <h3>创建点播</h3> <h4 class="fz12 fwbold">CREATE ON DEMAND</h4>
                        <hr/>
                    </div>
                    <form action="?s=mycenter/insertvod" method="post" class="forms">
                    <input type="hidden" name="email" id="email" value="{$email}"/>
                    <div class="live live_db clearfix">
                        <ul>
                            <li class="list_zb">
                                <span class="span">名称</span>
                                <input class="name_zb" style="width:401px;" type="text" name="title" id="name">
                                <span>视频分类</span>
                                <select style="height: 30px;width:133px;" id="phone_sowing" name="type" id="type">
                                    <volist name="list_channel_video" id="video">
                                    <option value="{$video.id}">{$video.cname}</option>
                                    </volist>
                                </select>
                            </li>
                            <li class="list_zb">
                                <span class="span fl">海报</span>
                                <input class="poster fl mr10" id="imgurl" type="text">
                                <input id="imgurlreal" type="hidden" name="picurl">
                                <label for="">
                                    浏览
                                    <input type="file" id="upload" value="..." class="">
                                </label>
                                <div class="imtext_con">
                                   <em id="imtext">未选择文件</em>
                                    <b id="bar2"></b>  
                                </div>
                                
                                    <button class="btn_zb ml12" type="button">上传</button>
                            </li>
                            <li class="list_zb list_db">
                                <span class="span">上传视频</span>

                                <div class="db_video">
                                    <a href="javascript:;" class="file">
                                        <input type="file" id="upload2" value="...">

                                        <h1 class="psha"></h1>
                                    </a>
                                </div>
                                <div class="dspl">
                                    <div class="right_top">
                                        <h2>视频转换码率</h2>
                                        <input class="ma0" type="radio" name="converse" checked="checked">流畅
                                        <input type="radio" name="converse">标清
                                        <input type="radio" name="converse">高清

                                    </div>
                                    <div class="right_bottom">
                                        <h2>下载权限</h2>
                                        <input class="ma0" type="radio" name="down_power" value="1" checked="checked">是
                                        <input type="radio" name="down_power" value="1">否
                                            <div class="button">
                                                <input type="button" class="subtext" value="点击上传" />
                                                <input type="hidden" id="voidUrl" name="playurl">
                                                <b id="bar3"></b>
                                            </div>
                                            
                                    </div>
                                </div>


                            </li>
                            <li class="list_zb">
                                <span>视频简介</span>
                                <textarea name="intro" style="width:603px;" id="brief_introduction"></textarea>
                            </li>
                            <li class="btn2" id="error" style="width:593px;margin-left:75px;">error位置</li>
                            <li class="btn1 fr" style="padding-right:2px;">
                                    <button type="button" id="show" class="m">公开</button>
                                    <input type="hidden" value="1" name="display" id="display">
                                    <button type="button" id="hide">隐藏</button>
                            </li>
                            
                            <li class="btn2 fr">
                                    <button type="button" id="sub">提交</button>
                                    <button type="button" id="reset">重置</button>
                            </li>
                        </ul>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="{$webpath}views/js/newjs/jquery.ui.widget.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="{$webpath}views/js/newjs/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="{$webpath}views/js/newjs/jquery.fileupload.js"></script>
<!-- The Load Image plugin is included for the preview images and image resizing functionality -->
<script src="http://blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js"></script>
<!-- The Canvas to Blob plugin is included for image resizing functionality -->
<script src="http://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
<!-- Bootstrap JS is not required, but included for the responsive demo navigation -->
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>



<!-- The File Upload processing plugin -->
<script src="{$webpath}views/js/newjs/jquery.fileupload-process.js"></script>
<!-- The File Upload image preview & resize plugin -->
<script src="{$webpath}views/js/newjs/jquery.fileupload-image.js"></script>
<!-- The File Upload audio preview plugin -->
<script src="{$webpath}views/js/newjs/jquery.fileupload-audio.js"></script>
<!-- The File Upload video preview plugin -->
<script src="{$webpath}views/js/newjs/jquery.fileupload-video.js"></script>
<!-- The File Upload validation plugin -->
<script src="{$webpath}views/js/newjs/jquery.fileupload-validate.js"></script>
<script>
/*jslint unparam: true */
/*global window, $ */
$(function () {
    'use strict';
    // Change this to the location of your server-side upload handler:
    var url = '?s=mycenter/uploadfile';
    $('.list_db .dspl .button .subtext').on('click', function () {
        var $this = $(this),
            data = $this.data();
            $this
        data.submit().always(function (data) {
            //$this.remove();
            $('#bar3').css(
                'width',
                0
            );
            //截取域名后的voidUrl
            //var voidUrl = data.files[0].url.replace("http://localhost/","");
            $("#voidUrl").val(data.files[0].url);
            $(".list_db .dspl .button .subtext").val('已上传');
            $(".list_db .dspl .button .subtext").attr("disabled","disabled");
            $(".mask2").hide();
        });
    });
    $('#upload2').fileupload({
        url: url,
        dataType: 'json',
        autoUpload: false,
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 999000,
        // Enable image resizing, except for Android and Opera,
        // which actually support image resizing, but fail to
        // send Blob objects via XHR requests:
        disableImageResize: /Android(?!.*Chrome)|Opera/
            .test(window.navigator.userAgent),
        previewMaxWidth: 103.75,
        previewMaxHeight: 76,
        previewCrop: true
    }).on('fileuploadadd', function (e, data) {
        //alert(23)
        $('#bar3').css(
            'width',
            0
        );
        console.log(data)
        $(".list_db .dspl .button .subtext").attr("disabled",false);
        $(".list_db .dspl .button .subtext").val('已选择，请上传');
        $(".list_db .dspl .button .subtext").data(data);

    }).on('fileuploadprogressall', function (e, data) {
       // alert(25)
        var progress = parseInt(data.loaded / data.total * 100, 10);
        if(progress<=100){
            $(".mask2").show();
        }
        $('#bar3').css(
            'width',
            progress + '%'
        );
    }).prop('disabled', !$.support.fileInput)
        .parent().addClass($.support.fileInput ? undefined : 'disabled');



















    $('.live .list_zb .btn_zb').on('click', function () {
        var $this = $(this),
            data = $this.data();
            $this
        data.submit().always(function (data) {
            console.log(data.files[0].url)
            console.log(data.files[0].url);
            //截取域名后的imgurl
            //var imgUrl = data.files[0].url.replace("http://localhost/","");
            $("#imgurl").val(data.files[0].url)
            $("#imgurlreal").val(data.files[0].url)
            $('#bar2').css(
                'width',
                0
            );
            $(".mask2").hide();
            $("#imtext").text('已上传')
            $(".live .list_zb .btn_zb").attr("disabled","disabled");
        });
    });
    $('#upload').fileupload({
            url: url,
            dataType: 'json',
            autoUpload: false,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 999000,
            // Enable image resizing, except for Android and Opera,
            // which actually support image resizing, but fail to
            // send Blob objects via XHR requests:
            disableImageResize: /Android(?!.*Chrome)|Opera/
                .test(window.navigator.userAgent),
            previewMaxWidth: 103.75,
            previewMaxHeight: 76,
            previewCrop: true
        }).on('fileuploadadd', function (e, data) {
            console.log(data.files[0].name)
                console.log(data)
                var imgName = data.files[0].name;
                var filename;
                if(imgName.indexOf("\\")>0)//如果包含有"/"号 从最后一个"/"号+1的位置开始截取字符串
                {
                    filename=imgName.substring(imgName.lastIndexOf("\\")+1,imgName.length);
                }
                else
                {
                    filename=imgName;
                }
                if(!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(filename)){
                    alert("图片类型必须是.gif,jpeg,jpg,png格式");
                    $('.live .list_zb .btn_zb').attr("disabled","disabled")
                }else{
                    $('.live .list_zb .btn_zb').attr("disabled",false)
                    $("#imtext").text(filename)
                }
             $('.live .list_zb .btn_zb').data(data);
             $(".live .list_zb .btn_zb").attr("disabled",false);

        }).on('fileuploadprogressall', function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#bar2').css(
                'width',
                progress + '%'
            );
            if(progress<=100){
                $(".mask2").show();
            }
        }).prop('disabled', !$.support.fileInput)
        .parent().addClass($.support.fileInput ? undefined : 'disabled');

    /*$('#upload').fileupload({
        url: url,
        dataType: 'json',
        done: function (e, data) {
            var _thsi = this;
            $.each(data.result.files, function (index, file) {
                var imgName = file.name;
                var filename;
                if(imgName.indexOf("\\")>0)//如果包含有"/"号 从最后一个"/"号+1的位置开始截取字符串
                {
                    filename=imgName.substring(imgName.lastIndexOf("\\")+1,imgName.length);
                }
                else
                {
                    filename=imgName;
                }
                if(!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(filename)){
                    alert("图片类型必须是.gif,jpeg,jpg,png格式");
                    
                }else{
                    $("#imtext").text(filename)
                }
            });
        },
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#bar2').css({'width':progress + '%'});
            if(progress >= 100){
                $('#bar2').css({'width':0});
                $(".live .list_zb .btn_zb").text("已上传");
                $(".mask2").hide();
            };
            if(progress < 100){
                $(".mask2").show();
            }
        }
    }).prop('disabled', !$.support.fileInput)
        .parent().addClass($.support.fileInput ? undefined : 'disabled');*/
});
</script>
<script>
    
    //显示隐藏的选择切换
    $("#show").click(function(){
        $("#display").attr("value", 1);
        $(this).addClass("m");
        $("#hide").removeClass("m");
    })
    $("#hide").click(function(){
        $("#display").attr("value", 0);
        $(this).addClass("m");
        $("#show").removeClass("m");
    })

    $(".live .btn1 button").mouseenter(function(){
        $(this).addClass("m").siblings().removeClass("m");
    })
    //提交重置按钮
    $("#sub").click(function(){
        if($("#name").val() == "")
        {
            $("#error").html("名称不能为空");
            return false;
        }
        else if($("#imgurlreal").val() == "")
        {
            $("#error").html("请上传海报");
            return false;
        }
        else if($("#voidUrl").val() == "")
        {
            $("#error").html("视频不能为空");
            return false;
        }
        else if($("#intro").val() == "")
        {
            $("#error").html("请填写视频简介");
            return false;
        }
        else
        {
            $("#sub").attr("type","submit");
        }

    })

    //点击重置按钮
    $("#reset").click(function(){
        location.reload();
    })
</script>
</body>
</html>

