<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>首页</title>
	<link rel="stylesheet" type="text/css" href="{$webpath}views/css/newcss/reset.css">
	<link rel="stylesheet" type="text/css" href="{$webpath}views/css/newcss/style.css">
	<script src="{$webpath}views/js/newjs/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="{$webpath}js/ntv_utils.js"></script>

	<script type="text/javascript" src="{$webpath}jwplayer/jwplayer.js"></script>

	<!-- version 7 license key --->
	<script type="text/javascript">jwplayer.key="38uAPADVt3eQaliBV2/DIi2ia+QhrVz0lhwLMg==";</script>

</head>

<!--  
<body class="videoplay" onLoad="InitDoc()" onUnload="close_player()" topmargin="0" leftmargin="0" rightmargin="0" bottommargin="0" marginwidth="0" marginheight="0">
-->
<body class="videoplay" onload="alert('aaa');" onUnload="close_player()" topmargin="0" leftmargin="0" rightmargin="0" bottommargin="0" marginwidth="0" marginheight="0">
<include file="header" />
<div class="nav padding_t20 margin_t20 bd_b">
    <ul class="fix margin_auto">
        <a href="{$webpath}"><li class="fix"><b>首页</b><span></span></li></a>
        <gxcms name="menu">
            <a href="{$menu.showurl}"><li class="fix"><b>{$menu.cname}</b><span></span></li></a>
        </gxcms>
    </ul>
	</div> 
	<div class="back_color">
		<div class="cqwz fix width1184 margin_auto padding_t15">
			<p><em class="fl_l">当前位置: </em><span class="fl_l">首页 ></span> <span class="fl_l">{$cname}</span></p>
		</div>
		<div class="_video margin_auto margin_b20 margin_t20 fix">
			<div class="_video_t fix">
				<div class="video_l fl_l" id="fxplayer"><!--<img src="{$webpath}views/images/newimages/pic1.jpg" alt="">--></div>
				<div class="fl_r video_r">
					<include file="chat" />
				</div>
			</div>
			<div class="_video_b">
				<ul class="video_nav fix">
					<li class="li1 m">正在播放</li>
					<li>视频简介</li>
				</ul>
				<div class="con_list">
                    <div class="fix disblock">
                        <volist name="vers" id="v" key='ii'>
                        <if condition="$ii eq 1">
                            <a href="{$webpath}?s=video/play/id/{$id}/ver/{$ii}" target="_blank" style="background-color:#999;">第{$ii}节</a>
                            <else />
                            <a href="{$webpath}?s=video/play/id/{$id}/ver/{$ii}" target="_blank">第{$ii}节</a>
                        </if>
                        </volist>
                    </div>
                    <!--&lt;!&ndash;剧集 开始&ndash;&gt;-->
                    <!--<volist name="ppplay" id="video">-->
                        <!--<div class="fix disblock" id="play_ji_{$i}" <if condition="$i eq 1"> class="show"<else />class="hide"</if>>-->
                            <!--&lt;!&ndash;剧集 开始&ndash;&gt;-->
                            <!--<div class="juji">-->
                                <!--<volist name="video['son']" id="ppvodson" key='ii'>-->
                                    <!--<if condition="$ppvodson['playcount'] eq 1">-->
                                        <!--<img src="{$tplpath}images/play_icon.png" onmouseover="this.src='{$tplpath}images/play_icon_on.png'" onmouseout="this.src='{$tplpath}images/play_icon.png'" style="cursor:pointer;" onclick="to_play('{$webpath}?s=video/play/id/{$id}/ver/{$ii}/ctype/vod');"></img>-->
                                        <!--<else />-->
                                        <!--<if condition="$ii eq $ppvodson['playcount']">-->
                                            <!--<a href="{$webpath}?s=video/play/id/{$id}/ver/{$ii}/ctype/vod" target="_blank" style="background-color:#999;">{$ppvodson.playname}</a>-->
                                            <!--<else />-->
                                            <!--<a href="{$webpath}?s=video/play/id/{$id}/ver/{$ii}/ctype/vod" target="_blank">{$ppvodson.playname}</a>-->
                                        <!--</if>-->
                                    <!--</if>-->
                                <!--</volist>-->
                            <!--</div>-->
                            <!--&lt;!&ndash;剧集 结束&ndash;&gt;-->
                        <!--</div>-->
                        <!--<div class="fix disblock" <if condition="$hasver eq 1"> class="show"<else />class="hide"</if>>-->
                            <!--&lt;!&ndash;剧集 开始&ndash;&gt;-->
                            <!--<div class="juji">-->
                            <!--<volist name="vers" id="v" key='ii'>-->
                            <!--<if condition="$ii eq 1">-->
                                <!--<a href="{$webpath}?s=video/play/id/{$id}/ver/{$ii}" target="_blank" style="background-color:#999;">第{$ii}节</a>-->
                            <!--<else />-->
                                <!--<a href="{$webpath}?s=video/play/id/{$id}/ver/{$ii}" target="_blank">第{$ii}节</a>-->
                            <!--</if>-->
                            <!--</volist>-->
                            <!--</div>-->
                            <!--&lt;!&ndash;剧集 结束&ndash;&gt;-->
                        <!--</div>-->
                    <!--</volist>-->
                    <!--剧集 结束-->
                <div class="">
						<p>{$intro}</p>
					</div>
				</div>
			</div>
		</div>
		<div class="cnxh margin_auto margin_t20">
			<h6 class="margin_l10">猜你喜欢</h6>
			<span class="margin_l10">GUESS YOU LIKE</span>
		</div>
		<div class="content margin_auto">
			<ul class="con1 fix margin_b10" id="hot_video" href="{$webpath}index.php?s=my/show/id/hot_video/cid/{$cid}/limit/4">

			</ul>

            <div class="clear" style="height:15px;">&nbsp;</div>
		</div>


		<div class="pl comment width1184 margin_auto fix" id="Comments">

		</div>


	</div>
<script type="text/javascript" src="{$webpath}views/js/system.js"></script>
<script type="text/javascript" src="{$tplpath}yiku.js"></script>
<script type="text/javascript">
	var superHTML5 = 0;
	var superFLV = 0;
	var isPC = false;

	$(document).ready(function(){
		var name='{$title}';
		var num='{$playname}';
		var url=window.location.href;
		CheckAdd(name,'gxhis',url,num)
		var URL = document.URL.split('.html');
		URL = URL[0].match(/\d+.*/g)[0].match(/\d+/g);
		var Count = URL.length;
		var sid = URL[(Count-1)]*1;
		var array = new Array();

		if (window.applicationCache) {
			superHTML5 = 1;
		} else {
			superHTML5 = 0;
		}

		var fls = flashChecker();
		if(fls.f){
			superFLV = 1;
		}else{
			superFLV = 0;
		}

		isPC = IsPC();

		/*
		 switch(url_html_play)
		 {
		 case 1://每集生成时的播放

		 var URL = Player.Url.split(html_file_suffix+'?');
		 URL = URL[1].split('-');
		 Count = URL.length;

		 if (Count == 2)
		 {
		 array['sid'] = 0;
		 }else{
		 array['sid'] = URL[2]*1;
		 }




		 array['id'] = URL[0]*1;
		 array['pid'] = URL[1]*1;
		 break;
		 case 2:
		 var URL = Player.Url.split(html_file_suffix);
		 URL = URL[0].split('/');
		 var Count = URL.length;
		 URL = URL[Count-1].split('-');
		 Count = URL.length;

		 if (Count == 2)
		 {
		 array['sid'] = 0;
		 }else{
		 array['sid'] = URL[2]*1;
		 }
		 array['id'] = URL[0]*1;
		 array['pid'] = URL[1]*1;
		 break;
		 default: //动态模式下面的加载播放器
		 var URL = Player.Url.split(html_file_suffix);
		 URL = URL[0].split('/');
		 var Count = URL.length;
		 URL = URL[Count-1].split('-');
		 Count = URL.length;
		 //console.log(URL);
		 if (Count == 2)
		 {
		 array['sid'] = 0;
		 }else{
		 array['sid'] = URL[2]*1;
		 }
		 array['id'] = URL[0]*1;
		 array['pid'] = URL[1]*1;
		 break;
		 }


		 var type = playlistArr[array['sid']];

		 video_detail_tag_change2(type,10,'play_name_','play_ji_','on','off','show','hide');
		 */
		 InitDoc();
	});

	function IsPC()
	{
		var userAgentInfo = navigator.userAgent;
		var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
		var flag = true;
		for (var v = 0; v < Agents.length; v++) {
			if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
		}
		return flag;
	}

	function flashChecker() {
		var hasFlash = 0; //是否安装了flash
		var flashVersion = 0; //flash版本
		if (document.all) {
			var swf = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');
			if (swf) {
				hasFlash = 1;
				VSwf = swf.GetVariable("$version");
				flashVersion = parseInt(VSwf.split(" ")[1].split(",")[0]);
			}
		} else {
			if (navigator.plugins && navigator.plugins.length > 0) {
				var swf = navigator.plugins["Shockwave Flash"];
				if (swf) {
					hasFlash = 1;
					var words = swf.description.split(" ");
					for (var i = 0; i < words.length; ++i) {
						if (isNaN(parseInt(words[i]))) continue;
						flashVersion = parseInt(words[i]);
					}
				}
			}
		}
		return { f: hasFlash, v: flashVersion };
	}

	var playbyjw = false;

	function set_localpara()
	{
		var value = "";
		/*if(form1.chk_autoplay.checked)
		 {
		 value="autoplay=autostart";
		 }
		 else
		 {
		 value="autoplay=no";
		 }
		 document.cookie = value;
		 */
		if(form1.chk_player.checked)
		{
			value="player=jw";
		}
		else
		{
			value="player=adobe";
		}
		document.cookie = value;
	}

	function is_jwplayer()
	{
		var strcookie=document.cookie;
		if(strcookie.indexOf("jw")>=0)
		{
			return true;
		}
		else
		{
			return false;
		}
	}

	function is_autoplay()
	{
		var strcookie=document.cookie;
		if(strcookie.indexOf("autostart")>=0)
		{
			return true;
		}
		else
		{
			return false;
		}
	}

	function set_captions(mode,title)
	{
		var modetext="Playback";
		if(mode=="live")
		{
			modetext="Live streaming";
		}
		var tl_text = "<font color='#FFFFFF' size='5'>" + title +"</font>";
		var tp_text = "<font color='#FFFFFF' style='font-size: 20pt; font-weight: 700'>" + modetext + "</font>";

		// tl.innerHTML = tl_text;
		// tp.innerHTML = tp_text;
	}

	function play_flv(w,h,url,livemode,tl)
	{

		var autoplay = true;            //is_autoplay();
		var usejw    = true;            //is_jwplayer();
		// set_captions(livemode,tl);
		if(usejw && livemode!="live")
		{
			jwplayer('fxplayer').setup({
				file:   url,
				image:  'jwplayer/jwplayer.jpg',
				title:  tl ,
				width:  w,
				height: h,
				autostart: autoplay,
				logo: {
					//file: '{$webpath}views/images/player_logo.png',
					link: ''
				},
				abouttext: "关于方讯",
				aboutlink: "",
				//aspectratio: '16:9',
				startparam: 'start'
			});
			playbyjw = true;
		}
		else
		{
			//play(w,h,url,livemode,autoplay);
			jwplayer('fxplayer').setup({
				file:   url,
				image:  'jwplayer/jwplayer.jpg',
				title:  tl ,
				width:  w,
				height: h,
				autostart: autoplay,
				logo: {
					//file: '{$webpath}views/images/player_logo.png',
					link: ''
				},
				abouttext: "关于方讯",
				aboutlink: ""
				//aspectratio: '16:9',
				//startparam: 'start'
			});
			playbyjw = true;


		}

	}

	function close_player()
	{
		if(playbyjw)
		{
			jwplayer().stop();
		}
	}

	function getUrlParam(name)
	{
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null)
		{
			return unescape(r[2]);
		}
		else
		{
			return null;
		}
	}

	function playVod(url,title)
	{
		var h = 651;
		var w = 937;
		play_flv(w,h,url,"",title);
	}

	function playLive(url,title)
	{
		var h = 651;
		var w = 937;
		play_flv(w,h,url,"live",title);
	}

	function playHTML5(url,title)
	{
		var text = "<video src=\"" + url + "\" controls=\"controls\" autoplay=\"autoplay\" width=\"640px\" height=\"360px\">";  //
		text = text + "<font color='#FFFFFF'>您的浏览器不支持   HTML5 !</font>";
		text = text + "</video>";

		var doc = "<body bgcolor=\"#000000\">" +
				"<table border=\"0\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" height=\"100%\" >" +
				"<tr>" +
				"<td align=\"center\">"  +
				text +
				"</td></tr></table></body>";
		fxplayer.innerHTML = text;
		//document.write(text);
	}

	function play_rtsp(url, title){
		var text = "<object type=\"application/x-vlc-plugin\" pluginspage=\"http://www.videolan.org/\" id=\"vlc\" events=\"false\" width=\"704\" height=\"576\">";
		text = text + " <param name=\"mrl\" value=\"" + url + "\" />";
		text = text + " <param name=\"volume\" value=\"50\" />";
		text = text + " <param name=\"autoplay\" value=\"true\" />";
		text = text + " <param name=\"loop\" value=\"false\" />";
		text = text + " <param name=\"fullscreen\" value=\"true\" />";
		text = text + " <param name=\"controls\" value=\"true\" />";
		text = text + " </object>";
		fxplayer.innerHTML = text;

	}

	function playHLS(url,title) {
		set_captions("vod",title);
		//location.href = url;
		playHTML5(url,title);
	}

	function playMP4(url,title)
	{
		set_captions("vod",title);
		playHTML5(url,title);
	}

	function gen_rtsp_live_url(host, app, stream, token, port){
		var url   = "rtsp://"  + host + ":" + port + "/" + app + "/" + stream;
		return url;
	}

	function gen_rtmp_live_url(host,app,stream,token,port)
	{
		var url   = "rtmp://"  + host + ":" + port + "/" + app + "/" + stream;
		var npos = host.indexOf(":");
		if(npos>0)
		{
			url = "rtmp://"  + host.substr(0,npos) + "/" + app + "/" + stream;
		}

		if(token!="")
		{
			url = url + "?token=" + token;
		}
		else{
			url = url + "?token=";
		}
		return url;
	}

	function gen_flv_vod_url(host,app,stream,ver,token)
	{
		var url  = "http://"  + host + "/sps/" + app + "/" + stream + ".flv?ver=" + ver;
		if(token!="")
		{
			url = url + "&token=" + token;
		}
		return url;
	}

	function gen_mp4_url(host,app,stream,ver,token)
	{
		//var   url= "http://" + host + "/media/mp4/" + app + "/" + stream + "/" + stream;
		var   url= "http://" + host + "/mp4/" + app + "/" + stream + "/" + stream;
		if(ver>=0)
		{
			url = url + "_v" + ver;
		}
		url    = url  + ".mp4";
		if(token!="")
		{
			url = url + "?token=" + token;
		}else{
			url = url + "?token=";
		}
		return url;
	}

	function gen_hls_url(host,app,stream,ver,token)
	{
		var d = new Date();
		var url  = "http://"  + host + "/m3u8/" + app + "/" + stream + ".m3u8?from=mgr";
		if(ver!=null)
		{
			url = url + "&ver=" + ver;
		}
		// url = url + "&uid=m" + d.getTime();
		if(token!="")
		{
			url = url + "&token=" + token;
		}

		return url;
	}


	function InitDoc()
	{
		var url    = '{$url}';
		var app    = '{$app}';
		var stream = '{$stream}';
		var live   = '{$ctype}';
		var host   = '{$host}';
		var ver    = '{$ver}';
		var format = '{$format}';
		var tl     = "<?php echo $title;?>";//getUrlParam("title");
		var port   = '{$port}';
		var token  = "<?php echo $token;?>";

		//  var autoplay = is_autoplay();
		//  var jwplayer = is_jwplayer();
		var  uid     = getUrlParam("uid");
		if(uid=="" || uid==null)
		{
			uid     = ntv_uuid(16,16);
		}

		if(url!="" && url!=null)
		{
			return play_stream(url);
		}

		if(app==null || stream==null)
		{
			fxplayer.innerHTML= "<font color=\"#FFFFFF\">Load stream error!</font>";
			return;
		}

		if(tl==null || tl=="")
		{
			tl = app + " - " + stream;
		}

		if(port==null || port=="")
		{
			port = "1935";
		}

		if((host==null) || (host == ""))
		{
			host  = document.location.host;
		}
		if((ver==null) || (ver == ""))
		{
			ver="-1";
		}
		if(format==null)
		{
			format="flv";
		}

		if(live=="live")
		{
			if(isPC){
				if(format=="flv")
				{
					url  = gen_rtmp_live_url(host,app,stream,token,port);
					url  = url + "&live=1&uid=" + uid + "&sid=" + uid;
					playLive(url,tl);
				}
				else if(format=="hls")
				{
					url = gen_hls_url(host,app,stream,null,token);
					url  = url +  "&live=1&uid=" + uid + "&sid=" + uid;
					playHLS(url,tl);
				}else if(format == "rtsp"){
					url = gen_rtsp_live_url(host, app, stream, token, port);
					play_rtsp(url, tl);
				}
			}else{
				url = gen_hls_url(host,app,stream,null,token);
				url  = url +  "&live=1" +  "&uid=" + uid + "&sid=" + uid;
				playHLS(url,tl);
			}
		}
		else
		{
			// alert("flv:" + superFLV + "; html5:" + superHTML5);

			if(isPC){
				if(superFLV == 1){

					//alert("app:" + app + ";stream:" + stream);
					url = gen_flv_vod_url(host,app,stream, ver,token);
					url  = url + "&uid=" + uid + "&sid=" + uid;
					//alert(url);
					playVod(url,tl);
				}else if(superHTML5 == 1){
					url = gen_mp4_url(host,app,stream,ver,token);
					url  = url + "&uid=" + uid + "&sid=" + uid;
					playMP4(url,tl);
				}else{
					url = gen_hls_url(host,app,stream,ver,token);
					url  = url + "&uid=" + uid + "&sid=" + uid;
					playHLS(url,tl);
				}
			}else{
				url = gen_hls_url(host,app,stream,ver,token);
				url  = url + "&uid=" + uid + "&sid=" + uid;
				playHLS(url,tl);

			}

			/*
			 if(format=="flv")
			 {
			 url = gen_flv_vod_url(host,app,stream,ver,token);
			 playVod(url,tl);
			 }
			 else if(format=="mp4")
			 {
			 url = gen_mp4_url(host,app,stream,ver,token);
			 playMP4(url,tl);
			 }
			 else if(format=="hls")
			 {
			 url = gen_hls_url(host,app,stream,ver,token);
			 playHLS(url,tl);
			 }
			 */
		}
		window.focus();
	}

	function close_player()
	{
		if(playbyjw)
		{
			jwplayer().stop();
		}
	}

	function play_stream(para)
	{
		var url = para;

		/*
		 if(url=="" || url==null)
		 {
		 url = form2.media_url.value;
		 if(url=="" || url==null)
		 {
		 return;
		 }
		 location.href = "autoplayer.php?media_url=" + escape(url);
		 return;
		 }


		 if(url.indexof("rtsp://") >= 0){
		 var text = "<OBJECT classid=\"clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921\" id=\"vlc\"";
		 text = text + " codebase=\"http://download.videolan.org/pub/videolan/vlc/0.8.6c/win32/axvlc.cab\" ";
		 text = text + " width=\"600\" height=\"480\" id=\"vlc\" events=\"True\">";
		 text = text + " <param name=\"MRL\" value=\"" + url + "\" />";
		 text = text + " <param name=\"Src\" value=\"\" />";
		 text = text + " <param name=\"ShowDisplay\" value=\"True\" />";
		 text = text + " <param name=\"AutoLoop\" value=\"False\" />";
		 text = text + " <param name=\"AutoPlay\" value=\"True\" />";
		 text = text + " <param name=\"Time\" value=\"True\"/>";
		 text = text + " <EMBED pluginspage=\"http://www.videolan.org\"";
		 text = text + "   type=\"application/x-vlc-plugin\"";
		 text = text + "   version=\"VideoLAN.VLCPlugin.2\"";
		 text = text + "   width=\"600\"";
		 text = text + "   height=\"480\"";
		 text = text + "   text=\"Waiting for video\"";
		 text = text + "   name=\"vlc\" >";
		 text = text + "</EMBED> ";
		 text = text + "</OBJECT> ";

		 fxplayer.innerHTML = text;
		 }else{
		 form2.media_url.value = url;
		 if(url.indexOf('.m3u8')>=0)
		 {
		 playHLS(url,"");
		 }
		 else if(url.indexOf('.flv')>=0)
		 {
		 playVod(url,"");
		 }
		 else if(url.indexOf('.mp4')>=0)
		 {
		 playMP4(url,"");
		 }
		 else
		 {
		 playLive(url,"Living stream");
		 }
		 }
		 */
	}

</script>
{$inserthits}
<include file="footer" />
</body>
</html>